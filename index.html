<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>å‘½è¿ä¹‹è½® - é˜²å¡æ­»ç¨³å®šç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; overflow: hidden; 
            /* èƒŒæ™¯è®¾ç½® */
            background-image: url('./bg.png'); 
            background-size: cover; background-position: center; 
            background-color: rgba(0, 0, 0, 0.6); background-blend-mode: multiply;
            font-family: 'Cinzel', serif; color: #d4af37; 
        }

        #camera-container {
            position: absolute; top: 20px; left: 20px;
            width: 160px; height: 120px; z-index: 10;
            border: 3px solid #d4af37; box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            border-radius: 4px; overflow: hidden;
            transform: scaleX(-1); opacity: 0; transition: opacity 1s;
        }
        video { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.5) contrast(1.2); }

        #header { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; z-index: 5; }
        h1 { margin: 0; font-size: 32px; letter-spacing: 5px; text-shadow: 0 0 20px #d4af37; }

        /* æ ‡ç­¾å¸ƒå±€ */
        #labels-container {
            position: absolute; bottom: 130px; width: 100%;
            display: flex; justify-content: center; gap: 20px;
            pointer-events: none; z-index: 5;
        }
        .card-label-box {
            width: 25%; max-width: 300px; min-width: 200px;
            text-align: center; opacity: 0; transition: opacity 1s;
        }
        .card-name {
            font-size: 16px; color: #fff; text-shadow: 0 0 10px #d4af37;
            background: rgba(0,0,0,0.7); padding: 10px; border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            display: block; width: 100%; box-sizing: border-box; line-height: 1.4;
        }
        .slot-title { 
            display: block; font-size: 14px; color: #d4af37; 
            font-weight: bold; margin-bottom: 5px; text-transform: uppercase;
        }

        #ui-layer { position: absolute; bottom: 30px; width: 100%; text-align: center; pointer-events: none; z-index: 5; opacity: 0; transition: opacity 1s; }
        #status { font-size: 20px; letter-spacing: 2px; background: rgba(0,0,0,0.8); padding: 15px 40px; border: 1px solid #d4af37; display: inline-block; border-radius: 30px; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); }
        #progress-bar { width: 0%; height: 4px; background: #d4af37; margin-top: 10px; border-radius: 2px; transition: width 0.1s; display: none; }

        /* é…ç½®é¢æ¿ */
        #settings-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 200; background: rgba(0,0,0,0.95); border: 2px solid #d4af37;
            padding: 30px; border-radius: 8px; min-width: 350px; max-width: 450px;
            max-height: 85vh; overflow-y: auto; display: none;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        #settings-panel.show { display: block; }
        .settings-group {
            margin-bottom: 15px;
        }
        .settings-label {
            color: #d4af37; font-weight: bold; font-size: 14px;
            display: block; margin-bottom: 5px;
        }
        .settings-input {
            width: 100%; box-sizing: border-box;
            background: rgba(255,255,255,0.1); border: 1px solid #d4af37;
            color: #d4af37; padding: 8px; border-radius: 4px;
            font-family: monospace; font-size: 12px;
        }
        .settings-input::placeholder { color: rgba(212,175,55,0.5); }
        .settings-btn {
            width: 100%; padding: 10px; margin-top: 8px;
            background: #d4af37; color: #000; border: none;
            border-radius: 4px; cursor: pointer; font-weight: bold;
            font-size: 14px; transition: all 0.3s;
        }
        .settings-btn:hover { background: #fff; transform: scale(1.02); }
        .settings-toggle {
            width: 40px; height: 24px; position: relative;
            background: rgba(255,255,255,0.1); border: 1px solid #d4af37;
            border-radius: 12px; cursor: pointer; display: inline-block;
            margin-left: 10px; vertical-align: middle;
        }
        .settings-toggle.active { background: #d4af37; }
        .settings-toggle::after {
            content: ''; position: absolute; width: 20px; height: 20px;
            background: #000; border-radius: 10px; top: 2px; left: 2px;
            transition: left 0.3s;
        }
        .settings-toggle.active::after { left: 18px; }
        .settings-title {
            font-size: 20px; color: #d4af37; border-bottom: 1px solid #d4af37;
            padding-bottom: 15px; margin-bottom: 20px; text-align: center;
            font-weight: bold;
        }

        /* è§£ç‰Œé¢æ¿ */
        #reading-panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 150;
            display: none; flex-direction: column; justify-content: center;
            align-items: center; overflow-y: auto; padding: 40px;
        }
        #reading-panel.show { display: flex; }
        .reading-content {
            background: rgba(0,0,0,0.8); border: 2px solid #d4af37;
            border-radius: 8px; padding: 30px; max-width: 800px;
            text-align: center; color: #d4af37;
        }
        .reading-card-name {
            font-size: 28px; font-weight: bold; margin-bottom: 20px;
            text-shadow: 0 0 10px #d4af37;
        }
        .reading-text {
            font-size: 16px; line-height: 1.8; color: #ccc;
            text-align: left; max-height: 400px; overflow-y: auto;
            margin-bottom: 20px;
        }
        .reading-text::-webkit-scrollbar {
            width: 6px;
        }
        .reading-text::-webkit-scrollbar-track {
            background: rgba(212,175,55,0.1);
        }
        .reading-text::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 3px;
        }
        .reading-controls {
            display: flex; gap: 10px; justify-content: center;
        }
        .reading-btn {
            padding: 10px 30px; background: #d4af37; color: #000;
            border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; font-size: 14px;
        }
        .reading-btn:hover { background: #fff; }
        .reading-loading {
            font-size: 18px; color: #d4af37; margin: 20px 0;
        }
        .reading-error {
            color: #ff6b6b; margin: 20px 0; font-size: 14px;
        }

        /* é€‰æ‹©è§£ç‰Œæ–¹å¼é¢æ¿ */
        #reading-choice-panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 150;
            display: none; flex-direction: column; justify-content: center;
            align-items: center; padding: 40px;
        }
        #reading-choice-panel.show { display: flex; }
        .choice-content {
            background: rgba(0,0,0,0.8); border: 2px solid #d4af37;
            border-radius: 8px; padding: 40px; max-width: 500px;
            text-align: center; color: #d4af37;
        }
        .choice-title {
            font-size: 32px; font-weight: bold; margin-bottom: 30px;
            text-shadow: 0 0 10px #d4af37;
        }
        .choice-subtitle {
            font-size: 16px; color: #ccc; margin-bottom: 40px;
        }
        .choice-buttons {
            display: flex; flex-direction: column; gap: 15px;
        }
        .choice-btn {
            padding: 20px; background: rgba(212,175,55,0.1); color: #d4af37;
            border: 2px solid #d4af37; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 18px; transition: all 0.3s;
            font-family: 'Cinzel', serif;
        }
        .choice-btn:hover {
            background: #d4af37; color: #000; transform: scale(1.05);
            box-shadow: 0 0 20px #d4af37;
        }
        .choice-btn-icon {
            font-size: 24px; margin-right: 10px;
        }
        .choice-btn-text {
            display: block; font-size: 14px; color: rgba(255,255,255,0.7);
            margin-top: 5px;
        }

        /* å¯åŠ¨ç•Œé¢ */
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        #start-btn { 
            padding: 20px 60px; border: 2px solid #d4af37; color: #d4af37; 
            font-family: 'Cinzel', serif; font-size: 24px; background: transparent; 
            cursor: pointer; opacity: 1; transition: all 0.3s; 
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); 
            margin-top: 20px;
        }
        #start-btn:hover { background: #d4af37; color: #000; box-shadow: 0 0 40px rgba(212, 175, 55, 0.6); }
        #loading-text { font-size: 18px; color: #ccc; margin-bottom: 10px; }

        /* ===== æ‰‹æœºé€‚é… ===== */
        @media (max-width: 768px) {
            h1 { font-size: 24px; letter-spacing: 3px; }
            
            #camera-container {
                width: 120px; height: 90px; top: 10px; left: 10px;
                border-width: 2px;
            }
            
            #labels-container {
                bottom: 100px; gap: 10px;
            }
            
            .card-label-box {
                width: 30%; max-width: 150px; min-width: 100px;
            }
            
            .card-name {
                font-size: 12px; padding: 8px;
            }
            
            .slot-title { 
                font-size: 11px; margin-bottom: 3px;
            }
            
            #status { 
                font-size: 14px; padding: 10px 20px;
            }
            
            #progress-bar { height: 3px; }
            
            #settings-panel {
                min-width: 85vw; max-width: 95vw;
                padding: 20px; margin: 10px;
                border-radius: 6px;
                max-height: 80vh;
            }
            
            .settings-title {
                font-size: 18px;
            }
            
            .settings-label {
                font-size: 13px;
            }
            
            .settings-input {
                font-size: 12px; padding: 6px;
            }
            
            .settings-btn {
                padding: 10px; font-size: 13px;
            }
            
            #reading-panel {
                padding: 20px;
            }
            
            .reading-content {
                padding: 20px; max-width: 95vw;
                border-radius: 6px;
            }
            
            .reading-card-name {
                font-size: 20px; margin-bottom: 15px;
            }
            
            .reading-text {
                font-size: 14px; max-height: 300px; margin-bottom: 15px;
            }
            
            .reading-btn {
                padding: 8px 20px; font-size: 13px;
            }
            
            #reading-choice-panel {
                padding: 20px;
            }
            
            .choice-content {
                padding: 30px 20px; max-width: 95vw;
                border-radius: 6px;
            }
            
            .choice-title {
                font-size: 24px; margin-bottom: 20px;
            }
            
            .choice-subtitle {
                font-size: 14px; margin-bottom: 30px;
            }
            
            .choice-btn {
                padding: 15px; font-size: 16px;
            }
            
            .choice-btn-icon {
                font-size: 20px;
            }
            
            .choice-btn-text {
                font-size: 12px; margin-top: 3px;
            }
            
            #start-btn {
                padding: 15px 40px; font-size: 18px;
            }
            
            #loading-text { font-size: 14px; }
        }
        
        @media (max-width: 480px) {
            h1 { font-size: 18px; letter-spacing: 2px; }
            
            #camera-container {
                width: 100px; height: 75px; top: 8px; left: 8px;
                border-width: 2px;
            }
            
            #labels-container {
                bottom: 90px; gap: 8px;
            }
            
            .card-label-box {
                width: 28%; max-width: 110px; min-width: 80px;
            }
            
            .card-name {
                font-size: 11px; padding: 6px;
            }
            
            .slot-title { 
                font-size: 10px; margin-bottom: 2px;
            }
            
            #status { 
                font-size: 12px; padding: 8px 15px;
            }
            
            #settings-panel {
                min-width: 90vw; max-width: 98vw;
                padding: 15px;
                max-height: 85vh;
            }
            
            .settings-title {
                font-size: 16px; margin-bottom: 15px;
            }
            
            .settings-group {
                margin-bottom: 12px;
            }
            
            .settings-label {
                font-size: 12px;
            }
            
            .settings-input {
                font-size: 11px; padding: 5px;
            }
            
            .settings-btn {
                padding: 8px; font-size: 12px; margin-top: 6px;
            }
            
            #reading-panel {
                padding: 15px;
            }
            
            .reading-content {
                padding: 15px;
            }
            
            .reading-card-name {
                font-size: 18px; margin-bottom: 12px;
            }
            
            .reading-text {
                font-size: 13px; max-height: 250px; margin-bottom: 12px;
                line-height: 1.6;
            }
            
            .reading-controls {
                gap: 8px;
            }
            
            .reading-btn {
                padding: 8px 15px; font-size: 12px;
            }
            
            .choice-content {
                padding: 25px 15px;
            }
            
            .choice-title {
                font-size: 20px; margin-bottom: 15px;
            }
            
            .choice-subtitle {
                font-size: 13px; margin-bottom: 20px;
            }
            
            .choice-buttons {
                gap: 10px;
            }
            
            .choice-btn {
                padding: 12px; font-size: 14px;
            }
            
            .choice-btn-icon {
                font-size: 18px; margin-right: 8px;
            }
            
            .choice-btn-text {
                font-size: 11px;
            }
            
            #start-btn {
                padding: 12px 30px; font-size: 16px;
            }
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>

    <div id="start-overlay">
        <h1 style="margin-bottom: 20px;">THE FATE TAROT</h1>
        <div id="loading-text">æ­£åœ¨è¿æ¥çµæ€§ç½‘ç»œ...</div>
        <div style="width: 200px; height: 2px; background: #333; border-radius: 2px; overflow: hidden;">
            <div id="loading-bar" style="width: 0%; height: 100%; background: #d4af37; transition: width 0.3s;"></div>
        </div>
        <button id="start-btn" style="display: none;">è¿›å…¥ä»ªå¼</button>
        <p style="color: #666; margin-top: 20px; font-size: 14px;">å¦‚æœåŠ è½½è¿‡æ…¢ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ä½¿ç”¨æ›¿è¡¥ç‰Œé¢</p>
    </div>

    <div id="header"><h1>TAROT OF FATE</h1></div>
    <div id="camera-container"><video id="input_video"></video></div>

    <div id="labels-container">
        <div id="label-box-0" class="card-label-box"><div class="card-name"><span class="slot-title">PAST Â· è¿‡å»</span><span class="card-content">...</span></div></div>
        <div id="label-box-1" class="card-label-box"><div class="card-name"><span class="slot-title">PRESENT Â· ç°åœ¨</span><span class="card-content">...</span></div></div>
        <div id="label-box-2" class="card-label-box"><div class="card-name"><span class="slot-title">FUTURE Â· æœªæ¥</span><span class="card-content">...</span></div></div>
    </div>

    <div id="ui-layer">
        <div id="status">å‡†å¤‡å°±ç»ª...</div>
        <div style="width: 300px; margin: 0 auto;"><div id="progress-bar"></div></div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div id="settings-panel">
        <div class="settings-title">âš™ï¸ AI è§£ç‰Œé…ç½®</div>
        
        <div class="settings-group">
            <label class="settings-label">å¯ç”¨ AI è§£ç‰Œ</label>
            <div class="settings-toggle" id="ai-toggle"></div>
        </div>

        <div class="settings-group">
            <label class="settings-label">API åŸºç¡€ URL</label>
            <input type="text" class="settings-input" id="api-base-url" 
                   placeholder="å¦‚: https://api.openai.com/v1">
        </div>

        <div class="settings-group">
            <label class="settings-label">API å¯†é’¥</label>
            <input type="password" class="settings-input" id="api-key" 
                   placeholder="è¾“å…¥æ‚¨çš„ API å¯†é’¥">
        </div>

        <div class="settings-group">
            <label class="settings-label">æ¨¡å‹</label>
            <input type="text" class="settings-input" id="model-name" 
                   placeholder="å¦‚: gpt-4, deepseek-chat">
        </div>

        <div class="settings-group">
            <label class="settings-label">è§£ç‰Œè¯­è¨€</label>
            <select class="settings-input" id="reading-language" style="cursor: pointer;">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">è‹±æ–‡</option>
                <option value="bilingual">ä¸­è‹±åŒè¯­</option>
            </select>
        </div>

        <div class="settings-group">
            <label class="settings-label">è§£ç‰Œé£æ ¼</label>
            <select class="settings-input" id="reading-style" style="cursor: pointer;">
                <option value="mystical">ç¥ç§˜å­¦æ´¾</option>
                <option value="psychological">å¿ƒç†å­¦æ´¾</option>
                <option value="practical">å®ç”¨ä¸»ä¹‰</option>
                <option value="poetic">è¯—æ„æ´¾</option>
            </select>
        </div>

        <button class="settings-btn" id="save-settings">ä¿å­˜è®¾ç½®</button>
        <button class="settings-btn" id="test-api" style="background: #666;">æµ‹è¯•è¿æ¥</button>
        <button class="settings-btn" id="start-reading" style="background: #4ade80; color: #000; margin-top: 15px;">å¼€å§‹è§£ç‰Œ</button>

        <div id="settings-message" style="margin-top: 10px; font-size: 12px; color: #4ade80; text-align: center; min-height: 20px;"></div>
    </div>

    <!-- è§£ç‰Œé¢æ¿ -->
    <div id="reading-panel">
        <div class="reading-content">
            <div class="reading-card-name" id="reading-card-name">ç‰Œå</div>
            <div id="reading-loading" class="reading-loading">âœ¨ çµèƒ½æ„Ÿåº”ä¸­...</div>
            <div id="reading-error" class="reading-error"></div>
            <div id="reading-text" class="reading-text"></div>
            <div class="reading-controls">
                <button class="reading-btn" id="next-reading">ä¸‹ä¸€å¼ </button>
                <button class="reading-btn" id="finish-reading">å®Œæˆä»ªå¼</button>
            </div>
        </div>
    </div>

    <!-- é€‰æ‹©è§£ç‰Œæ–¹å¼é¢æ¿ -->
    <div id="reading-choice-panel">
        <div class="choice-content">
            <div class="choice-title">âœ¨ ä»ªå¼å®Œæˆ âœ¨</div>
            <div class="choice-subtitle">é€‰æ‹©è§£ç‰Œæ–¹å¼</div>
            <div class="choice-buttons">
                <button class="choice-btn" id="choice-ai">
                    <span class="choice-btn-icon">ğŸ¤–</span>
                    <span>AI æ™ºèƒ½è§£ç‰Œ</span>
                    <span class="choice-btn-text">è·å¾— AI ç”Ÿæˆçš„æ·±åº¦è§£è¯»</span>
                </button>
                <button class="choice-btn" id="choice-normal">
                    <span class="choice-btn-icon">ğŸ”®</span>
                    <span>æ™®é€šè§£ç‰Œ</span>
                    <span class="choice-btn-text">æŸ¥çœ‹ç»å…¸å¡”ç½—è§£è¯»</span>
                </button>
            </div>
        </div>
    </div>

<script>
    // ===== æ™®é€šè§£ç‰Œæ–‡æ¡ˆåº“ =====
    const READING_LIBRARY = {
        '0. The Fool (æ„šè€…)': {
            meaning: 'æ–°çš„å¼€å§‹ã€å†’é™©ç²¾ç¥ã€æ— é™å¯èƒ½',
            past: 'è¿‡å»ï¼šä½ å……æ»¡äº†æ¢ç´¢æ¬²æœ›ï¼Œæ•¢äºå°è¯•æ–°äº‹ç‰©ã€‚é‚£æ—¶çš„ä½ æ— æ‰€ç•æƒ§ï¼Œå……æ»¡äº†å¯¹æœªæ¥çš„æ†§æ†¬ã€‚',
            present: 'ç°åœ¨ï¼šæ˜¯æ—¶å€™ç›¸ä¿¡ä½ çš„ç›´è§‰äº†ã€‚çœ¼å‰è™½æœ‰æœªçŸ¥ï¼Œä½†æ­£æ˜¯è¿™ä»½æœªçŸ¥ç»™äºˆä½ æ— é™çš„å¯èƒ½æ€§ã€‚',
            future: 'æœªæ¥ï¼šæ–°çš„æ—…ç¨‹å³å°†å±•å¼€ã€‚æ— è®ºæ˜¯æ–°çš„å…³ç³»ã€å·¥ä½œè¿˜æ˜¯å†’é™©ï¼Œéƒ½å°†ä¸ºä½ çš„äººç”Ÿæ³¨å…¥æ–°çš„æ´»åŠ›ã€‚',
            advice: 'ç›¸ä¿¡ç›´è§‰ï¼Œå‹‡æ•¢è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‚é£é™©ä¸­éšè—ç€æœºé‡ã€‚'
        },
        'I. The Magician (é­”æœ¯å¸ˆ)': {
            meaning: 'èƒ½åŠ›ã€æ„å¿—åŠ›ã€èµ„æºæŒæ§ã€åˆ›é€ åŠ›',
            past: 'è¿‡å»ï¼šä½ å±•ç°äº†å¼ºå¤§çš„æ‰§è¡ŒåŠ›å’Œåˆ›æ„ã€‚é€šè¿‡è‡ªå·±çš„åŠªåŠ›ï¼Œä½ æŒæ§äº†å½“æ—¶çš„å±€é¢ã€‚',
            present: 'ç°åœ¨ï¼šè¿™æ˜¯å±•ç°ä½ æ‰èƒ½çš„æ—¶å€™ã€‚ä½ æ‹¥æœ‰æ‰€éœ€çš„èµ„æºå’Œèƒ½åŠ›ï¼Œç°åœ¨è¦åšçš„æ˜¯æœ‰æ•ˆåœ°è¿ç”¨å®ƒä»¬ã€‚',
            future: 'æœªæ¥ï¼šä½ çš„æˆåŠŸå°†é€šè¿‡åˆ›æ–°å’Œè¡ŒåŠ¨åŠ›å¾—ä»¥å®ç°ã€‚å……åˆ†åˆ©ç”¨æ‰‹ä¸­çš„å·¥å…·å’Œæ™ºæ…§ã€‚',
            advice: 'å‘æŒ¥ä½ çš„åˆ›æ„å’Œèƒ½åŠ›ã€‚ä½ æ‹¥æœ‰å®ç°ç›®æ ‡çš„ä¸€åˆ‡èµ„æºã€‚'
        },
        'II. The High Priestess (å¥³ç¥­å¸)': {
            meaning: 'ç›´è§‰ã€æ™ºæ…§ã€ç¥ç§˜ã€æ½œæ„è¯†ã€éšè—çš„çœŸç›¸',
            past: 'è¿‡å»ï¼šæŸäº›ç¥ç§˜æˆ–éšè—çš„åŠ›é‡å½±å“äº†ä½ çš„ç»å†ã€‚ä½ å¯èƒ½è¢«æŸäº›äº‹æƒ…çš„è¡¨è±¡æ‰€è¿·æƒ‘ã€‚',
            present: 'ç°åœ¨ï¼šå€¾å¬ä½ å†…å¿ƒçš„å£°éŸ³ã€‚ç­”æ¡ˆå¯èƒ½éšè—åœ¨ä½ çš„æ½œæ„è¯†é‡Œï¼Œè€Œä¸æ˜¯å¤–éƒ¨ç¯å¢ƒä¸­ã€‚',
            future: 'æœªæ¥ï¼šéšè—çš„çœŸç›¸å°†é€æ¸æ˜¾éœ²ã€‚ä½ ä¼šè·å¾—æ–°çš„è®¤çŸ¥å’Œç†è§£ã€‚',
            advice: 'ç›¸ä¿¡ä½ çš„ç›´è§‰å’Œå†…åœ¨æ™ºæ…§ã€‚æœ‰äº›äº‹ç‰©éœ€è¦æ—¶é—´æ‰èƒ½ç†è§£ã€‚'
        },
        'III. The Empress (çš‡å)': {
            meaning: 'ä¸°ç››ã€åˆ›é€ åŠ›ã€å¥³æ€§èƒ½é‡ã€æ¯æ€§ã€ç¹è£',
            past: 'è¿‡å»ï¼šä½ äº«å—äº†ä¸°ç¡•çš„æˆæœã€‚ä½ çš„åˆ›æ„å’ŒåŠªåŠ›ä¸ºä½ å¸¦æ¥äº†ä¸°ç››å’Œå¹¸ç¦ã€‚',
            present: 'ç°åœ¨ï¼šè¿™æ˜¯æ”¶è·å’Œç¹è£çš„æ—¶åˆ»ã€‚ä½ å…·æœ‰åˆ›é€ å’Œæ»‹å…»ä»–äººçš„èƒ½åŠ›ã€‚',
            future: 'æœªæ¥ï¼šæ–°çš„æœºé‡å’Œä¸°ç››æ­£åœ¨åˆ°æ¥ã€‚ä½ çš„é¡¹ç›®å°†ç»“å‡ºæœå®ã€‚',
            advice: 'æ‹¥æŠ±ä¸°ç››å’Œåˆ›é€ ã€‚ç…§é¡¾å¥½è‡ªå·±å’Œå‘¨å›´çš„äººã€‚'
        },
        'IV. The Emperor (çš‡å¸)': {
            meaning: 'æƒåŠ›ã€æƒå¨ã€é¢†å¯¼åŠ›ã€ç¨³å®šã€çˆ¶æ€§',
            past: 'è¿‡å»ï¼šä½ æˆ–å‘¨å›´çš„äººå±•ç°äº†å¼ºå¤§çš„é¢†å¯¼åŠ›ã€‚æƒåŠ›å’Œç§©åºæ”¯é…äº†å½“æ—¶çš„å±€é¢ã€‚',
            present: 'ç°åœ¨ï¼šæ˜¯æ—¶å€™å‘æŒ¥ä½ çš„é¢†å¯¼åŠ›äº†ã€‚ä½ éœ€è¦å»ºç«‹æ¸…æ™°çš„è§„åˆ™å’Œç§©åºã€‚',
            future: 'æœªæ¥ï¼šä½ å°†è·å¾—æ›´å¤šçš„æƒåŠ›å’Œè´£ä»»ã€‚ç¨³å®šçš„æˆåŠŸåœ¨ç­‰å¾…ç€ä½ ã€‚',
            advice: 'é‡‡å–è¡ŒåŠ¨ï¼Œå»ºç«‹ç§©åºã€‚ç›¸ä¿¡ä½ çš„é¢†å¯¼èƒ½åŠ›ã€‚'
        },
        'V. The Hierophant (æ•™çš‡)': {
            meaning: 'ä¼ ç»Ÿã€ç²¾ç¥å¯¼å¸ˆã€ä¿¡å¿µã€å®—æ•™ã€æ•™è‚²',
            past: 'è¿‡å»ï¼šä¼ ç»Ÿæˆ–ç²¾ç¥ä¿¡å¿µæ·±åˆ»å½±å“äº†ä½ çš„æŠ‰æ‹©ã€‚ä½ æˆ–å¯»æ±‚è¿‡æŒ‡å¯¼ã€‚',
            present: 'ç°åœ¨ï¼šæ˜¯æ—¶å€™å¯»æ±‚æ™ºæ…§å’ŒæŒ‡å¯¼äº†ã€‚ä¼ ç»Ÿæ–¹æ³•å¯èƒ½æ›´ä¸ºæœ‰æ•ˆã€‚',
            future: 'æœªæ¥ï¼šä½ å¯èƒ½ä¼šè·å¾—æ›´æ·±å±‚çš„ç²¾ç¥ç†è§£ã€‚æˆ–æˆä¸ºä»–äººçš„æŒ‡å¯¼è€…ã€‚',
            advice: 'å°Šé‡ä¼ ç»Ÿæ™ºæ…§ã€‚å¯»æ±‚åˆé€‚çš„å¯¼å¸ˆæˆ–æŒ‡å¯¼ã€‚'
        },
        'VI. The Lovers (æ‹äºº)': {
            meaning: 'çˆ±ã€é€‰æ‹©ã€ä¼™ä¼´å…³ç³»ã€ä»·å€¼è§‚å¯¹é½ã€äº²å¯†',
            past: 'è¿‡å»ï¼šé‡è¦çš„å…³ç³»æˆ–é€‰æ‹©å®šä¹‰äº†ä½ çš„è¿‡å»ã€‚çˆ±æˆ–ä»·å€¼è§‚çš„ç¢°æ’å¯èƒ½å‘ç”Ÿè¿‡ã€‚',
            present: 'ç°åœ¨ï¼šå…³é”®çš„é€‰æ‹©æ‘†åœ¨é¢å‰ã€‚è¯šå®å¯¹å¾…ä½ çš„å¿ƒï¼Œå®¡è§†ä½ çœŸæ­£çš„ä»·å€¼è§‚ã€‚',
            future: 'æœªæ¥ï¼šæ·±åˆ»çš„è”ç³»å’Œç†è§£ç­‰å¾…ç€ä½ ã€‚å¯èƒ½æ˜¯çˆ±æƒ…ã€å‹è°Šæˆ–å†…åœ¨çš„å’Œè°ã€‚',
            advice: 'è·Ÿéšä½ çš„å¿ƒã€‚åšå‡ºä¸ä½ çœŸå®ä»·å€¼è§‚ä¸€è‡´çš„é€‰æ‹©ã€‚'
        },
        'VII. The Chariot (æˆ˜è½¦)': {
            meaning: 'æ„å¿—ã€å†³å¿ƒã€æ§åˆ¶ã€èƒœåˆ©ã€è¿åŠ¨',
            past: 'è¿‡å»ï¼šä½ é€šè¿‡æ„å¿—åŠ›å’Œå†³å¿ƒå…‹æœäº†å›°éš¾ã€‚å¼ºå¤§çš„æ‰§è¡ŒåŠ›ä¸ºä½ èµ¢å¾—äº†èƒœåˆ©ã€‚',
            present: 'ç°åœ¨ï¼šä½ å¤„äºæŒæ§å±€é¢çš„ä½ç½®ã€‚ç»§ç»­å‰è¿›ï¼Œä¸è¦æ”¾å¼ƒä½ çš„ç›®æ ‡ã€‚',
            future: 'æœªæ¥ï¼šèƒœåˆ©å³å°†æ¥ä¸´ã€‚ä½ çš„å†³å¿ƒå’Œè¡ŒåŠ¨å°†æŠŠä½ æ¨å‘æˆåŠŸã€‚',
            advice: 'ä¿æŒä¸“æ³¨å’Œå†³å¿ƒã€‚ä½ æœ‰èƒ½åŠ›æŒæ§å±€åŠ¿å’Œå®ç°ç›®æ ‡ã€‚'
        },
        'VIII. Strength (åŠ›é‡)': {
            meaning: 'å†…åœ¨åŠ›é‡ã€è€å¿ƒã€æ¸©æŸ”çš„åŠ›é‡ã€å‹‡æ°”ã€è‡ªåˆ¶åŠ›',
            past: 'è¿‡å»ï¼šä½ é€šè¿‡å†…åœ¨çš„å¼ºå¤§å’Œè€å¿ƒæ¸¡è¿‡äº†éš¾å…³ã€‚æ¸©æŸ”çš„åŠ›é‡è¯æ˜äº†å®ƒçš„æ•ˆæœã€‚',
            present: 'ç°åœ¨ï¼šä½ éœ€è¦æ¸©æŸ”ä½†åšå®šçš„åŠ›é‡ã€‚è€å¿ƒå’Œè‡ªåˆ¶åŠ›æ¯”è›®åŠ›æ›´æœ‰æ•ˆã€‚',
            future: 'æœªæ¥ï¼šä½ çš„å†…åœ¨åŠ›é‡å°†æ”¯æ’‘ä½ åº¦è¿‡æŒ‘æˆ˜ã€‚èƒœåˆ©å±äºåšæŒè€…ã€‚',
            advice: 'ç›¸ä¿¡ä½ çš„å†…åœ¨åŠ›é‡ã€‚ç”¨æ¸©æŸ”è€Œåšå®šçš„æ–¹å¼é¢å¯¹å›°éš¾ã€‚'
        },
        'IX. The Hermit (éšå£«)': {
            meaning: 'å†…çœã€æœå¯»ã€æ²‰é»˜ã€æ™ºæ…§ã€å­¤ç‹¬',
            past: 'è¿‡å»ï¼šä½ ç»å†äº†æ²‰æ€å’Œå†…çœã€‚ç‹¬å¤„ç»™äº†ä½ é‡è¦çš„æ´å¯Ÿã€‚',
            present: 'ç°åœ¨ï¼šæ˜¯æ—¶å€™å‘å†…çœ‹äº†ã€‚è¿œç¦»å–§åš£ï¼Œå¯»æ±‚å†…åœ¨çš„æ™ºæ…§å’Œç­”æ¡ˆã€‚',
            future: 'æœªæ¥ï¼šä½ å°†æ‰¾åˆ°ä½ ä¸€ç›´å¯»æ±‚çš„ç­”æ¡ˆã€‚æ²‰æ€å°†å¸¦æ¥å¯è’™ã€‚',
            advice: 'èŠ±æ—¶é—´ä¸è‡ªå·±ç›¸å¤„ã€‚å†…åœ¨çš„æ™ºæ…§æ­£åœ¨ç­‰å¾…è¢«å‘ç°ã€‚'
        },
        'X. Wheel of Fortune (å‘½è¿ä¹‹è½®)': {
            meaning: 'å‘¨æœŸã€å‘½è¿ã€è½¬æœºã€å˜åŒ–ã€å¹¸è¿',
            past: 'è¿‡å»ï¼šå‘½è¿çš„è½¬è½®åœ¨è½¬åŠ¨ã€‚ä½ ç»å†äº†å˜åŒ–å’Œæ–°çš„å¼€å§‹ã€‚',
            present: 'ç°åœ¨ï¼šå˜åŒ–å°±åœ¨çœ¼å‰ã€‚è¿™æ˜¯å‡†å¤‡æ–°å¾ªç¯çš„æ—¶åˆ»ã€‚',
            future: 'æœªæ¥ï¼šå¥½è¿å³å°†åˆ°æ¥ã€‚ç”Ÿæ´»çš„è½®å­ç»§ç»­è½¬åŠ¨ï¼Œæ–°çš„æœºé‡å°†å‡ºç°ã€‚',
            advice: 'æ‹¥æŠ±å˜åŒ–ã€‚ç›¸ä¿¡å‘½è¿ä¼šçœ·é¡¾ä½ ã€‚'
        },
        'XI. Justice (æ­£ä¹‰)': {
            meaning: 'å…¬æ­£ã€å¹³è¡¡ã€çœŸç†ã€æ³•å¾‹ã€å› æœ',
            past: 'è¿‡å»ï¼šä½ é­é‡äº†å› æœæˆ–éœ€è¦åšå‡ºå…¬æ­£çš„é€‰æ‹©ã€‚å¹³è¡¡è¢«æ‰“ç ´æˆ–æ¢å¤ã€‚',
            present: 'ç°åœ¨ï¼šæ˜¯æ—¶å€™åšå‡ºå…¬æ­£çš„å†³å®šäº†ã€‚è¦è€ƒè™‘æ‰€æœ‰å› ç´ ï¼Œå¯»æ±‚å¹³è¡¡ã€‚',
            future: 'æœªæ¥ï¼šæ­£ä¹‰ä¼šå¾—åˆ°ä¼¸å¼ ã€‚å› æœæ³•åˆ™åœ¨å‘æŒ¥ä½œç”¨ã€‚',
            advice: 'åšå‡ºå…¬æ­£çš„å†³å®šã€‚ç›¸ä¿¡å› æœå¾ªç¯ã€‚'
        },
        'XII. The Hanged Man (å€’åŠäºº)': {
            meaning: 'ç‰ºç‰²ã€ç­‰å¾…ã€æ–°çš„è§†è§’ã€æš‚åœã€çµæ€§å¯è’™',
            past: 'è¿‡å»ï¼šä½ åšå‡ºäº†ç‰ºç‰²æˆ–å¤„äºæš‚åœçš„çŠ¶æ€ã€‚æ¢ä¸ªè§’åº¦çœ‹å¾…è¿‡å»çš„äº‹ä»¶ã€‚',
            present: 'ç°åœ¨ï¼šæš‚åœå’Œç­‰å¾…æ˜¯å¿…è¦çš„ã€‚æ”¾å¼ƒä½ çš„æ‰§ç€ï¼Œä»¥è·å¾—æ–°çš„è§†è§’ã€‚',
            future: 'æœªæ¥ï¼šæ–°çš„ç†è§£å’Œçµæ€§å¯è’™åœ¨ç­‰å¾…ã€‚æš‚åœå°†å¸¦æ¥è½¬æœºã€‚',
            advice: 'æ”¾å¼ƒä¸€äº›ä¸œè¥¿æ¥è·å¾—æ›´å¤šã€‚æ¢ä¸ªè§’åº¦çœ‹å¾…æƒ…å†µã€‚'
        },
        'XIII. Death (æ­»ç¥)': {
            meaning: 'è½¬å˜ã€ç»“æŸã€æ–°å¼€å§‹ã€é‡Šæ”¾ã€é‡ç”Ÿ',
            past: 'è¿‡å»ï¼šä¸€ä¸ªé‡è¦çš„å‘¨æœŸå·²ç»ç»“æŸã€‚è¿™ä¸ºæ–°çš„å¼€å§‹é“ºå¹³äº†é“è·¯ã€‚',
            present: 'ç°åœ¨ï¼šä¸€ä¸ªé‡è¦çš„è½¬å˜æ­£åœ¨å‘ç”Ÿã€‚æ”¾å¼ƒæ—§çš„ï¼Œæ‹¥æŠ±æ–°çš„ã€‚',
            future: 'æœªæ¥ï¼šé‡ç”Ÿå’Œæ–°çš„å¼€å§‹åœ¨ç­‰å¾…ã€‚æ—§çš„ä¼šç»™ä½æ–°çš„ã€‚',
            advice: 'æ‹¥æŠ±å˜åŒ–ã€‚ç»“æŸå¾€å¾€æ˜¯æ–°å¼€å§‹çš„å¼€ç«¯ã€‚'
        },
        'XIV. Temperance (èŠ‚åˆ¶)': {
            meaning: 'å¹³è¡¡ã€èåˆã€æ¸©å’Œã€è€å¿ƒã€å’Œè°',
            past: 'è¿‡å»ï¼šå¹³è¡¡å’ŒèŠ‚åˆ¶å¸®åŠ©äº†ä½ åº¦è¿‡éš¾å…³ã€‚èåˆä¸åŒå…ƒç´ å¸¦æ¥äº†å’Œè°ã€‚',
            present: 'ç°åœ¨ï¼šå¯»æ±‚å¹³è¡¡å’Œæ¸©å’Œçš„æ–¹æ³•ã€‚èåˆä¸åŒçš„è§‚ç‚¹å’Œèµ„æºã€‚',
            future: 'æœªæ¥ï¼šå’Œè°å’Œå¹³è¡¡å°†è¢«æ¢å¤ã€‚èŠ‚åˆ¶çš„åŠ›é‡ä¼šæŒ‡å¼•ä½ ã€‚',
            advice: 'å¯»æ±‚ä¸­é“ã€‚èåˆå’Œå¹³è¡¡æ˜¯è§£å†³æ–¹æ¡ˆã€‚'
        },
        'XV. The Devil (æ¶é­”)': {
            meaning: 'æŸç¼šã€ç‰©æ¬²ã€é»‘æš—é¢ã€ç¼ºä¹è‡ªç”±ã€è¯±æƒ‘',
            past: 'è¿‡å»ï¼šä½ å¯èƒ½è¢«æŸäº›æ¬²æœ›æˆ–ææƒ§æ‰€æŸç¼šã€‚ä½ çš„æŸäº›é€‰æ‹©é™åˆ¶äº†è‡ªå·±ã€‚',
            present: 'ç°åœ¨ï¼šå®¡è§†ä½ çš„æŸç¼šã€‚ä½ å¯èƒ½è¢«å¹»æƒ³æˆ–ç‰©æ¬²æ‰€æ¬ºéª—ã€‚',
            future: 'æœªæ¥ï¼šè§£æ”¾åœ¨ç­‰å¾…ã€‚é¢å¯¹ä½ çš„ææƒ§ï¼Œè¶…è¶Šä½ çš„é™åˆ¶ã€‚',
            advice: 'è®¤è¯†åˆ°ä½ çš„æŸç¼šã€‚ä½ æ‹¥æœ‰è§£æ”¾è‡ªå·±çš„åŠ›é‡ã€‚'
        },
        'XVI. The Tower (é«˜å¡”)': {
            meaning: 'å´©æºƒã€çªå˜ã€å¯è’™ã€ç ´åã€çœŸç›¸',
            past: 'è¿‡å»ï¼šä¸€ä¸ªçªç„¶çš„å´©æºƒæˆ–å¯è’™äº‹ä»¶æ”¹å˜äº†ä½ ã€‚è™šå‡çš„åŸºç¡€è¢«æ‘§æ¯ã€‚',
            present: 'ç°åœ¨ï¼šä¸€ä¸ªçªç„¶çš„å˜åŒ–å³å°†æˆ–æ­£åœ¨å‘ç”Ÿã€‚è¿™è™½ç„¶ç—›è‹¦ä½†å¿…è¦ã€‚',
            future: 'æœªæ¥ï¼šä»åºŸå¢Ÿä¸­ä¼šé‡å»ºæ–°çš„åŸºç¡€ã€‚å¯è’™å’Œæ¸…æ™°ä¼šéšä¹‹è€Œæ¥ã€‚',
            advice: 'æ‹¥æŠ±å´©æºƒå’Œé‡å»ºã€‚æ¯æ¬¡ç ´åéƒ½æ˜¯æ–°ç”Ÿçš„æœºä¼šã€‚'
        },
        'XVII. The Star (æ˜Ÿæ˜Ÿ)': {
            meaning: 'å¸Œæœ›ã€çµæ„Ÿã€æŒ‡å¼•ã€æ¸…æ™°ã€æ¢¦æƒ³',
            past: 'è¿‡å»ï¼šå¸Œæœ›å’Œçµæ„Ÿå¼•å¯¼äº†ä½ ã€‚ä½ çš„æ¢¦æƒ³é—ªé—ªå‘å…‰ã€‚',
            present: 'ç°åœ¨ï¼šé‡æ‹¾ä½ çš„å¸Œæœ›å’Œæ¢¦æƒ³ã€‚æ¸…æ™°çš„ç›®æ ‡æ­£åœ¨æ˜¾ç°ã€‚',
            future: 'æœªæ¥ï¼šä½ çš„æ¢¦æƒ³å°†æŒ‡å¼•ä½ èµ°å‘æˆåŠŸã€‚æ˜Ÿå…‰ç…§äº®ä½ çš„é“è·¯ã€‚',
            advice: 'è¿½éšä½ çš„æ¢¦æƒ³ã€‚å¸Œæœ›å’Œæ¸…æ™°çš„ç›®æ ‡æ˜¯ä½ çš„ç¯å¡”ã€‚'
        },
        'XVIII. The Moon (æœˆäº®)': {
            meaning: 'å¹»è§‰ã€æ½œæ„è¯†ã€ä¸å®‰ã€ç›´è§‰ã€ç§˜å¯†',
            past: 'è¿‡å»ï¼šå¹»è§‰æˆ–ä¸ç¡®å®šç¬¼ç½©äº†ä½ ã€‚ä½ çš„æ½œæ„è¯†å¯èƒ½åœ¨è¯‰è¯´ä»€ä¹ˆã€‚',
            present: 'ç°åœ¨ï¼šä¿¡ä»»ä½ çš„ç›´è§‰ã€‚äº‹ç‰©å¯èƒ½ä¸å¦‚è¡¨é¢çœ‹èµ·æ¥çš„é‚£æ ·ã€‚',
            future: 'æœªæ¥ï¼šçœŸç›¸å°†é€æ¸æ˜¾éœ²ã€‚ä½ çš„ç›´è§‰ä¼šå¼•å¯¼ä½ ã€‚',
            advice: 'å€¾å¬ä½ çš„æ½œæ„è¯†ã€‚åŒºåˆ†ç°å®å’Œå¹»è§‰ã€‚'
        },
        'XIX. The Sun (å¤ªé˜³)': {
            meaning: 'å¹¸ç¦ã€æˆåŠŸã€æ´»åŠ›ã€æ¸…æ™°ã€æ­£é¢èƒ½é‡',
            past: 'è¿‡å»ï¼šå…‰èŠ’ç…§äº®äº†ä½ çš„é“è·¯ã€‚å¹¸ç¦å’ŒæˆåŠŸæ ‡è®°äº†é‚£ä¸ªæ—¶æœŸã€‚',
            present: 'ç°åœ¨ï¼šå…‰æ˜å’Œæ¸…æ™°çš„æ—¶åˆ»ã€‚ç§¯æçš„èƒ½é‡ç¯ç»•ç€ä½ ã€‚',
            future: 'æœªæ¥ï¼šå…‰è£çš„æˆåŠŸç­‰å¾…ç€ä½ ã€‚å¹¸ç¦å’Œç¹è£å°±åœ¨çœ¼å‰ã€‚',
            advice: 'æ‹¥æŠ±å…‰æ˜å’Œæ­£é¢èƒ½é‡ã€‚ä½ çš„æœ€å¥½æ—¶å…‰è¿˜åœ¨å‰æ–¹ã€‚'
        },
        'XX. Judgement (å®¡åˆ¤)': {
            meaning: 'è§‰é†’ã€è½¬æœºã€è¯„ä¼°ã€å‘¼å”¤ã€å¤å…´',
            past: 'è¿‡å»ï¼šä½ ç»å†äº†è§‰é†’æˆ–é‡è¦çš„è¯„ä¼°æ—¶åˆ»ã€‚é‡è¦çš„å†³å®šè¢«åšå‡ºã€‚',
            present: 'ç°åœ¨ï¼šè½¬æœºæ¥ä¸´ã€‚æ˜¯æ—¶å€™å›åº”å†…å¿ƒçš„å‘¼å”¤äº†ã€‚',
            future: 'æœªæ¥ï¼šæ–°çš„å¼€å§‹åŸºäºè¿‡å»çš„æ•™è®­ã€‚å¤å…´å’Œå‡ååœ¨ç­‰å¾…ã€‚',
            advice: 'å€¾å¬ä½ å†…å¿ƒçš„å‘¼å”¤ã€‚åšå‡ºå†³å®šæ€§çš„è½¬å˜ã€‚'
        },
        'XXI. The World (ä¸–ç•Œ)': {
            meaning: 'å®Œæˆã€æˆå°±ã€æ•´ä½“æ€§ã€åœ†æ»¡ã€æ–°å‘¨æœŸ',
            past: 'è¿‡å»ï¼šä¸€ä¸ªé‡è¦çš„å‘¨æœŸåœ†æ»¡ç»“æŸã€‚ä½ å–å¾—äº†é‡å¤§æˆå°±ã€‚',
            present: 'ç°åœ¨ï¼šåœ†æ»¡å°±åœ¨çœ¼å‰ã€‚æ•´ä½“å’Œå®Œæˆæ­£åœ¨å®ç°ã€‚',
            future: 'æœªæ¥ï¼šæˆåŠŸå’Œå®Œæˆå°†è¢«å®ç°ã€‚ä¸€ä¸ªæ–°çš„å‘¨æœŸå³å°†å¼€å§‹ã€‚',
            advice: 'åº†ç¥ä½ çš„æˆå°±ã€‚æ•´ä½“å’Œè°æ­£åœ¨å®ç°ã€‚'
        }
    };

    // ===== åŠ è½½txtè¡¥å……åº“ï¼ˆåµŒå…¥å¼æ•°æ®ï¼‰=====
    const supplementaryReadings = {
        '0. The Fool (æ„šè€…)': 'åœ¨å¿ƒç†å­¦è§’åº¦çœ‹ï¼Œæ„šè€…ä»£è¡¨äº†äººç±»çš„åŸå§‹å†²åŠ¨å’Œå¯¹è‡ªç”±çš„æ¸´æœ›ã€‚è¿™å¼ ç‰Œæé†’æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™çœŸæ­£çš„æ™ºæ…§æ¥è‡ªäºæ•¢äºæ”¾ä¸‹ç†æ€§çš„æŸç¼šï¼Œå»è¿½éšå†…å¿ƒçš„å£°éŸ³ã€‚æ¯ä¸€æ®µæ–°çš„å¼€å§‹éƒ½éœ€è¦ä¸€äº›"æ„šè ¢"çš„å‹‡æ°”ã€‚',
        'I. The Magician (é­”æœ¯å¸ˆ)': 'é­”æœ¯å¸ˆçš„çœŸæ­£åŠ›é‡ä¸æ˜¯æ¥è‡ªå¤–éƒ¨ï¼Œè€Œæ˜¯æ¥è‡ªäºå¯¹è‡ªèº«èƒ½åŠ›çš„æ·±åˆ»è®¤çŸ¥å’Œä¿¡å¿ƒã€‚ä»–æ•™ä¼šæˆ‘ä»¬ï¼Œæ¯ä¸ªäººéƒ½æ˜¯è‡ªå·±äººç”Ÿçš„åˆ›é€ è€…ï¼Œåªè¦æˆ‘ä»¬å­¦ä¼šæ•´åˆå’Œè¿ç”¨æ‰‹ä¸­çš„èµ„æºã€‚è¿™éœ€è¦ä¸“æ³¨ã€çºªå¾‹å’ŒæŒç»­çš„ç»ƒä¹ ã€‚',
        'II. The High Priestess (å¥³ç¥­å¸)': 'åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œå¥³ç¥­å¸æé†’æˆ‘ä»¬è¦å­¦ä¼šé™å¿ƒå’Œè§‚å¯Ÿã€‚çœŸæ­£çš„çŸ¥è¯†å¾€å¾€éšè—åœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œéœ€è¦æˆ‘ä»¬çš„ç›´è§‰å’Œè€å¿ƒå»å‘ç°ã€‚å¥¹ä»£è¡¨äº†é˜´æ€§èƒ½é‡çš„æ™ºæ…§â€”â€”è¢«åŠ¨çš„æ¥çº³ã€æ·±å±‚çš„ç†è§£ã€ç¥ç§˜çš„åŠ›é‡ã€‚',
        'III. The Empress (çš‡å)': 'çš‡åä¸ä»…ä»£è¡¨æ¯æ€§ï¼Œæ›´ä»£è¡¨äº†è‡ªæˆ‘ä»·å€¼çš„è‚¯å®šå’Œä¸°ç››æ„è¯†çš„å»ºç«‹ã€‚å¥¹å‘Šè¯‰æˆ‘ä»¬ï¼ŒçœŸæ­£çš„åŠ›é‡æ¥è‡ªäºè‡ªæˆ‘çˆ±æŠ¤å’Œè‡ªæˆ‘æ¬£èµã€‚å½“æˆ‘ä»¬æ‡‚å¾—ç…§é¡¾è‡ªå·±æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å»å…³çˆ±å’Œæ»‹å…»ä»–äººã€‚ä¸°ç››å§‹äºå†…åœ¨çš„æ»¡è¶³ã€‚',
        'IV. The Emperor (çš‡å¸)': 'çš‡å¸ä»£è¡¨äº†ç»“æ„åŒ–æ€ç»´å’Œçºªå¾‹çš„åŠ›é‡ã€‚åœ¨ç°ä»£ç¤¾ä¼šï¼Œçš‡å¸çš„èƒ½é‡ç‰¹åˆ«é‡è¦â€”â€”å®ƒæé†’æˆ‘ä»¬éœ€è¦æœ‰æ¸…æ™°çš„ç›®æ ‡ã€åšå®šçš„è®¡åˆ’å’Œæœæ•¢çš„è¡ŒåŠ¨ã€‚ä½†åŒæ—¶ï¼Œè¿‡åº¦çš„æ§åˆ¶æ¬²å¯èƒ½å¯¼è‡´å‹åˆ¶å’ŒåƒµåŒ–ï¼Œæ™ºæ…§çš„çš‡å¸çŸ¥é“ä½•æ—¶æ”¾æ¾æŒæ§ã€‚',
        'V. The Hierophant (æ•™çš‡)': 'æ•™çš‡æ˜¯ä¼ ç»Ÿå’Œæ™ºæ…§çš„å®ˆæŠ¤è€…ï¼Œä½†è¿™ä¸æ„å‘³ç€å›ºæ­¥è‡ªå°ã€‚ç°ä»£çš„æ•™çš‡èƒ½é‡æ˜¯å…³äºå»ºç«‹æœ‰æ„ä¹‰çš„æ¡†æ¶å’Œä»·å€¼ä½“ç³»ï¼Œæ— è®ºæ˜¯å®—æ•™çš„ã€ä¼¦ç†çš„è¿˜æ˜¯ä¸ªäººçš„ã€‚ä»–é‚€è¯·æˆ‘ä»¬åœ¨å°Šé‡ä¼ ç»Ÿçš„åŒæ—¶ï¼Œå¯»æ‰¾é€‚åˆå½“ä»£çš„è¡¨è¾¾æ–¹å¼ã€‚',
        'VI. The Lovers (æ‹äºº)': 'æ‹äººç‰Œä¸ä»…å…³äºæµªæ¼«çš„çˆ±æƒ…ï¼Œæ›´å…³ä¹é€‰æ‹©ã€æ‰¿è¯ºå’Œä»·å€¼è§‚çš„åŒé¢‘ã€‚è¿™å¼ ç‰Œæé†’æˆ‘ä»¬ï¼Œæœ€æ·±åˆ»çš„è”ç³»æ¥è‡ªäºçœŸå®çš„å¯¹è¯å’Œç›¸äº’çš„ç†è§£ã€‚å®ƒä¹Ÿä»£è¡¨äº†å†…åœ¨çš„ä¸€è‡´æ€§â€”â€”å½“æˆ‘ä»¬çš„æ€æƒ³ã€è¨€è¯­å’Œè¡ŒåŠ¨ä¿æŒä¸€è‡´æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å»çˆ±å’Œè¢«çˆ±ã€‚',
        'VII. The Chariot (æˆ˜è½¦)': 'æˆ˜è½¦æ˜¯æ„å¿—åŠ›å’Œå†³å¿ƒçš„è±¡å¾ã€‚ä½†çœŸæ­£çš„èƒœåˆ©ä¸ä»…éœ€è¦é©¾é©­ï¼Œæ›´éœ€è¦æ–¹å‘å’Œå¹³è¡¡ã€‚ä¸¤åŒ¹é©¬å¿…é¡»åè°ƒä¸€è‡´æ‰èƒ½å‰è¿›ã€‚è¿™æ•™ä¼šæˆ‘ä»¬ï¼ŒæˆåŠŸéœ€è¦æ•´åˆæˆ‘ä»¬çš„å„ç§èƒ½åŠ›å’Œå†²åŠ¨ï¼Œè€Œä¸æ˜¯å‹åˆ¶å®ƒä»¬ã€‚å‰è¿›çš„åŠ›é‡æ¥è‡ªäºå†…éƒ¨çš„å’Œè°ã€‚',
        'VIII. Strength (åŠ›é‡)': 'çœŸæ­£çš„åŠ›é‡ä¸åœ¨äºè‚Œè‚‰æˆ–è›®åŠ›ï¼Œè€Œåœ¨äºå¯¹è‡ªæˆ‘çš„æ·±åˆ»ç†è§£å’Œæ¸©æŸ”çš„åŠ›é‡ã€‚å›¾åƒä¸­çš„å¥³äººç”¨æ¸©æŸ”å»é©¯æœç‹®å­ï¼Œè¿™è±¡å¾äº†é€šè¿‡åŒæƒ…å’Œè€å¿ƒå»æ•´åˆæˆ‘ä»¬å†…å¿ƒçš„é‡æ€§èƒ½é‡ã€‚è¿™æ˜¯ä¸€ç§éœ€è¦æ›´å¤šå‹‡æ°”çš„åŠ›é‡â€”â€”æ—¢ä¸å‹åˆ¶ä¹Ÿä¸çºµå®¹ã€‚',
        'IX. The Hermit (éšå£«)': 'åœ¨ç°ä»£çš„å¿«èŠ‚å¥ç”Ÿæ´»ä¸­ï¼Œéšå£«èƒ½é‡å˜å¾—æ›´åŠ çè´µã€‚è¿™å¼ ç‰Œé‚€è¯·æˆ‘ä»¬å®šæœŸé€€å‡ºç¤¾äº¤æ¼©æ¶¡ï¼Œè¿›è¡Œæ·±åº¦çš„è‡ªæˆ‘åæ€ã€‚éšå£«çš„ç¯ç¬¼ä¸ä»…ç…§äº®äº†ä»–è‡ªå·±çš„è·¯ï¼Œä¹Ÿä¸ºä»–äººæŒ‡å¼•æ–¹å‘ã€‚å†…åœ¨çš„å…‰æ¥è‡ªäºå¯¹è‡ªæˆ‘çš„æ·±åˆ»äº†è§£ã€‚',
        'X. Wheel of Fortune (å‘½è¿ä¹‹è½®)': 'å‘½è¿ä¹‹è½®æé†’æˆ‘ä»¬ï¼Œç”Ÿå‘½æ˜¯å¾ªç¯çš„ã€‚æ²¡æœ‰æ°¸æ’çš„ä¸Šå‡æˆ–ä¸‹é™ï¼Œåªæœ‰ä¸æ–­çš„è½¬å˜ã€‚è¿™å¼ ç‰Œç»™äºˆæˆ‘ä»¬å¸Œæœ›å’Œè°¦å‘â€”â€”å¸Œæœ›åœ¨å›°éš¾æ—¶æœŸï¼Œè°¦å‘åœ¨é¡ºåˆ©æ—¶æœŸã€‚å…³é”®æ˜¯å­¦ä¼šé¡ºåº”å˜åŒ–ï¼Œè€Œä¸æ˜¯æŠ—æ‹’å®ƒã€‚',
        'XI. Justice (æ­£ä¹‰)': 'æ­£ä¹‰ç‰Œæ˜¯å› æœæ³•åˆ™çš„ä½“ç°ã€‚å®ƒæé†’æˆ‘ä»¬æ¯ä¸ªè¡ŒåŠ¨éƒ½æœ‰ç›¸åº”çš„åæœï¼Œæ— è®ºè¿™ä¸ªåæœä½•æ—¶åˆ°æ¥ã€‚åœ¨ç°ä»£ç¤¾ä¼šä¸­ï¼Œæ­£ä¹‰èƒ½é‡ä¹Ÿä»£è¡¨äº†å…¬å¹³æ€§ã€é€æ˜åº¦å’Œè¯šå®çš„æ²Ÿé€šã€‚å®ƒè¦æ±‚æˆ‘ä»¬å¯¹è‡ªå·±çš„é€‰æ‹©è´Ÿè´£ï¼ŒåŒæ—¶ä¹Ÿç»™äºˆæˆ‘ä»¬å¯¹å…¬æ­£çš„ä¿¡å¿ƒã€‚',
        'XII. The Hanged Man (å€’åŠäºº)': 'å€’åŠäººæ˜¯æœ€è¢«è¯¯è§£çš„å¡ç‰Œã€‚ä»–ä¸æ˜¯å—å®³è€…ï¼Œè€Œæ˜¯é€šè¿‡è‡ªæ„¿çš„æš‚åœå’Œä¸åŒçš„è§†è§’æ¥è·å¾—æ™ºæ…§çš„äººã€‚è¿™å¼ ç‰Œåœ¨ç°ä»£ç”Ÿæ´»ä¸­æé†’æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™åœæ­¢å‰è¿›æ¯”ç»§ç»­å‰è¿›æ›´éœ€è¦å‹‡æ°”ã€‚å˜æ¢è§†è§’å¾€å¾€æ¯”æ”¹å˜ç¯å¢ƒæ›´æœ‰åŠ›é‡ã€‚',
        'XIII. Death (æ­»ç¥)': 'æ­»ç¥æ˜¯æœ€å¼ºå¤§çš„è½¬å˜åŠ›é‡ã€‚è™½ç„¶åå­—ä»¤äººææƒ§ï¼Œä½†è¿™å¼ ç‰Œä»£è¡¨çš„æ˜¯è‡ªç„¶çš„èœ•å˜â€”â€”å†¬å¤©ä¹‹åæ˜¯æ˜¥å¤©ï¼Œç»“æŸä¹‹åæ˜¯æ–°ç”Ÿã€‚åœ¨ç°ä»£è¯­å¢ƒä¸­ï¼Œå®ƒå¯ä»¥ä»£è¡¨èŒä¸šçš„è½¬å˜ã€å…³ç³»çš„ç»“æŸæˆ–è‡ªæˆ‘è®¤çŸ¥çš„æ­»äº¡ä¸é‡ç”Ÿã€‚æ‹¥æŠ±å®ƒæ„å‘³ç€ç›¸ä¿¡ç”Ÿå‘½çš„æ°¸æ’å¾ªç¯ã€‚',
        'XIV. Temperance (èŠ‚åˆ¶)': 'èŠ‚åˆ¶ä¸æ˜¯ç¦æ¬²ï¼Œè€Œæ˜¯å¹³è¡¡å’Œèåˆã€‚è¿™å¼ ç‰Œæ•™ä¼šæˆ‘ä»¬å¦‚ä½•å°†ç›¸å¯¹çš„åŠ›é‡è°ƒå’Œåœ¨ä¸€èµ·ï¼Œåˆ›é€ å‡ºå’Œè°çš„ç”Ÿæ´»ã€‚å®ƒåœ¨ç°ä»£ç¤¾ä¼šä¸­ç‰¹åˆ«é‡è¦â€”â€”æ•™ä¼šæˆ‘ä»¬åœ¨å·¥ä½œå’Œç”Ÿæ´»ã€ç†æ€§å’Œæ„Ÿæ€§ã€ç»™äºˆå’Œæ¥æ”¶ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚',
        'XV. The Devil (æ¶é­”)': 'æ¶é­”ç‰Œé€šå¸¸ä»£è¡¨æˆ‘ä»¬å¯¹è‡ªå·±çš„æŸç¼šå’Œé™åˆ¶ä¿¡å¿µã€‚ä½†è¿™ä¸ª"æ¶é­”"çš„çœŸæ­£åŠ›é‡åœ¨äºâ€”â€”å®ƒæ˜¯æˆ‘ä»¬è‡ªå·±åˆ›é€ çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¹Ÿæœ‰åŠ›é‡å»è§£æ”¾è‡ªå·±ã€‚æ¶é­”é‚€è¯·æˆ‘ä»¬é¢å¯¹æˆ‘ä»¬çš„ææƒ§ã€æ¬²æœ›å’Œè‡ªæˆ‘æ¬ºéª—ï¼Œä»è€Œè·å¾—çœŸæ­£çš„è‡ªç”±ã€‚',
        'XVI. The Tower (é«˜å¡”)': 'é«˜å¡”æ˜¯çªç„¶çš„å¯è’™ã€‚è™½ç„¶è¿™ä¸ªè¿‡ç¨‹å¾€å¾€æ˜¯ç—›è‹¦çš„ï¼Œä½†å®ƒå¸¦æ¥çš„æ¸…æ™°æ˜¯æ— ä»·çš„ã€‚è¿™å¼ ç‰Œåœ¨ç”Ÿæ´»ä¸­å‡ºç°æ—¶ï¼Œæ„å‘³ç€è™šå‡çš„åŸºç¡€æ­£åœ¨åå¡Œï¼Œä¸ºçœŸå®çš„é‡å»ºé“ºå¹³é“è·¯ã€‚ä»æ··ä¹±ä¸­è¯ç”Ÿçš„æ–°ç§©åºå¾€å¾€æ›´åŠ åšå›ºã€‚',
        'XVII. The Star (æ˜Ÿæ˜Ÿ)': 'æ˜Ÿæ˜Ÿæ˜¯å¸Œæœ›çš„å…·ä½“åŒ–ã€‚åœ¨é»‘æš—ä¸­ï¼Œä¸€é¢—æ˜Ÿè¶³ä»¥æŒ‡å¼•æˆ‘ä»¬å‰è¡Œã€‚è¿™å¼ ç‰Œé¼“åŠ±æˆ‘ä»¬è¿½éšæˆ‘ä»¬çš„çœŸå®æ¢¦æƒ³ï¼Œè€Œä¸æ˜¯ç¤¾ä¼šçš„æœŸæœ›ã€‚æ˜Ÿæ˜Ÿä¹Ÿä»£è¡¨äº†çµæ€§çš„è¿æ¥å’Œä¸æ›´å¤§çš„å®‡å®™åŠ›é‡çš„å¯¹é½ã€‚å®ƒæé†’æˆ‘ä»¬ï¼Œæˆ‘ä»¬çš„æ¢¦æƒ³æ˜¯å€¼å¾—çš„ã€‚',
        'XVIII. The Moon (æœˆäº®)': 'æœˆäº®ä»£è¡¨äº†å¿ƒçµå’Œæ½œæ„è¯†çš„é¢†åŸŸã€‚åœ¨æœˆå…‰ä¸‹ï¼ŒçœŸå®å’Œå¹»è§‰çš„ç•Œé™å˜å¾—æ¨¡ç³Šã€‚è¿™å¼ ç‰Œé‚€è¯·æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬çš„ç›´è§‰ï¼ŒåŒæ—¶ä¹Ÿè¦è­¦æƒ•è‡ªæˆ‘æ¬ºéª—ã€‚æ¢¦å¢ƒã€ç›´è§‰å’Œåˆ›æ„åœ¨æœˆäº®çš„èƒ½é‡ä¸­è“¬å‹ƒå‘å±•ï¼Œä½†æˆ‘ä»¬ä¹Ÿéœ€è¦å­¦ä¼šåŒºåˆ†ææƒ§å’ŒçœŸå®çš„è­¦å‘Šã€‚',
        'XIX. The Sun (å¤ªé˜³)': 'å¤ªé˜³æ˜¯æœ€ç§¯æçš„èƒ½é‡ã€‚å®ƒä»£è¡¨äº†æ˜ç¡®çš„æˆåŠŸã€æ¸…æ™°çš„é“è·¯å’Œæ— æ¡ä»¶çš„å–œæ‚¦ã€‚åœ¨ç”Ÿæ´»ä¸­è·å¾—å¤ªé˜³ç‰Œæ„å‘³ç€ä¸€ä¸ªå…‰æ˜çš„æ—¶æœŸåˆ°æ¥ã€‚è¿™æ˜¯å®ç°ã€å¹¸ç¦å’Œç”Ÿå‘½åŠ›çš„æ—¶åˆ»ã€‚å¤ªé˜³ä¹Ÿæé†’æˆ‘ä»¬ï¼Œå³ä½¿åœ¨æœ€é»‘æš—çš„æ—¶åˆ»ï¼Œå…‰çº¿ä¹Ÿæ€»æ˜¯ä¼šå›æ¥çš„ã€‚',
        'XX. Judgement (å®¡åˆ¤)': 'å®¡åˆ¤ä¸æ˜¯å…³äºè¢«è¯„åˆ¤ï¼Œè€Œæ˜¯å…³äºå¬åˆ°å†…åœ¨çš„å‘¼å”¤å¹¶åšå‡ºå›åº”ã€‚è¿™å¼ ç‰Œä»£è¡¨äº†é‡è¦çš„è½¬æŠ˜ç‚¹â€”â€”ä¸€ä¸ªæ¸…æ™°çš„"æ˜¯"æˆ–"å¦"çš„å†³å®šæ—¶åˆ»ã€‚å®ƒä¹Ÿä»£è¡¨äº†å¯¹è¿‡å»çš„è¯„ä¼°å’Œå¯¹æ–°ç« èŠ‚çš„æ‰¿è¯ºã€‚å®¡åˆ¤ç‰Œå‡ºç°æ—¶ï¼Œé€šå¸¸æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨è¢«é‚€è¯·è¿›å…¥ä¸€ä¸ªæ›´é«˜çš„æ„è¯†å±‚æ¬¡ã€‚',
        'XXI. The World (ä¸–ç•Œ)': 'ä¸–ç•Œç‰Œæ˜¯åœ†æ»¡å’Œå®Œæˆã€‚å®ƒä¸æ˜¯ç»“æŸï¼Œè€Œæ˜¯ä¸€ä¸ªå‘¨æœŸçš„å®Œæˆï¼Œä¸ºæ–°å‘¨æœŸçš„å¼€å§‹åšå‡†å¤‡ã€‚è¿™å¼ ç‰Œä»£è¡¨äº†æ•´ä½“æ€§ã€ä¸€ä½“æ„Ÿå’Œé€šè¿‡å®Œæˆä¸€ä¸ªç« èŠ‚è€Œè·å¾—çš„æ™ºæ…§ã€‚ä¸–ç•Œä¹Ÿæ˜¯æ—…ç¨‹â€”â€”å¡”ç½—22å¼ ç‰Œçš„æ—…ç¨‹â€”â€”ä»æ„šè€…çš„æ— çŸ¥åˆ°ä¸–ç•Œçš„å®Œæ•´ç†è§£ã€‚'
    };
    
    function loadSupplementaryReadings() {
        console.log('âœ“ è¡¥å……è§£è¯»åº“å·²åŠ è½½');
        console.log('ğŸ“Š è¡¥å……è§£è¯»ç»Ÿè®¡:', Object.keys(supplementaryReadings).length, 'å¼ å¡ç‰Œ');
    }

    // é»˜è®¤è§£è¯»å‡½æ•° - ä½¿ç”¨æ–‡æ¡ˆåº“ + txtè¡¥å……
    function getDefaultReading(cardInfo) {
        if (!cardInfo || !cardInfo.name) {
            return 'è¯·æ ¹æ®ç‰Œä¹‰è¿›è¡Œé»˜è®¤è§£è¯»ã€‚';
        }

        const library = READING_LIBRARY[cardInfo.name];
        
        if (!library) {
            return `ã€${cardInfo.name}ã€‘\n\næ–‡æ¡ˆåº“ä¸­æš‚æ— è¯¥ç‰Œçš„å®Œæ•´è§£è¯»ï¼Œè¯·ç­‰å¾…è¡¥å……ã€‚`;
        }

        // æ ¹æ®å½“å‰çš„è¯»ç‰Œä½ç½®ï¼ˆè¿‡å»ã€ç°åœ¨ã€æœªæ¥ï¼‰è¿”å›å¯¹åº”çš„è§£è¯»
        const position = currentReadingIndex;
        let reading = '';

        if (position === 0) {
            // ç¬¬ä¸€å¼ ï¼šè¿‡å»
            reading = `ã€${cardInfo.name}ã€‘\n\n${library.past}`;
        } else if (position === 1) {
            // ç¬¬äºŒå¼ ï¼šç°åœ¨
            reading = `ã€${cardInfo.name}ã€‘\n\n${library.present}`;
        } else if (position === 2) {
            // ç¬¬ä¸‰å¼ ï¼šæœªæ¥
            reading = `ã€${cardInfo.name}ã€‘\n\n${library.future}`;
        }

        reading += `\n\nå…³é”®è¯ï¼š${library.meaning}\nå»ºè®®ï¼š${library.advice}`;
        
        // æ·»åŠ txtæ–‡ä»¶ä¸­çš„è¡¥å……å†…å®¹
        if (supplementaryReadings[cardInfo.name]) {
            console.log(`ğŸ” æ‰¾åˆ°è¡¥å……è§£è¯»: ${cardInfo.name}`);
            reading += `\n\nğŸ“š è¡¥å……è§£è¯»ï¼š\n${supplementaryReadings[cardInfo.name]}`;
        } else {
            console.log(`âŒ æœªæ‰¾åˆ°è¡¥å……è§£è¯»: ${cardInfo.name}`, 'å¯ç”¨çš„å¡ç‰Œ:', Object.keys(supplementaryReadings));
        }
        
        return reading;
    }

    // ===== AI è§£ç‰Œé…ç½®ç®¡ç† =====
    const AIConfig = {
        enabled: localStorage.getItem('ai_enabled') === 'true',
        apiBaseUrl: localStorage.getItem('ai_api_url') || 'https://api.openai.com/v1',
        apiKey: localStorage.getItem('ai_api_key') || '',
        model: localStorage.getItem('ai_model') || 'gpt-4',
        language: localStorage.getItem('reading_language') || 'zh',
        style: localStorage.getItem('reading_style') || 'mystical',

        save() {
            localStorage.setItem('ai_enabled', this.enabled);
            localStorage.setItem('ai_api_url', this.apiBaseUrl);
            localStorage.setItem('ai_api_key', this.apiKey);
            localStorage.setItem('ai_model', this.model);
            localStorage.setItem('reading_language', this.language);
            localStorage.setItem('reading_style', this.style);
        }
    };

    // åˆå§‹åŒ–è®¾ç½®é¢æ¿
    function initSettingsPanel() {
        const toggle = document.getElementById('ai-toggle');
        const urlInput = document.getElementById('api-base-url');
        const keyInput = document.getElementById('api-key');
        const modelInput = document.getElementById('model-name');
        const langSelect = document.getElementById('reading-language');
        const styleSelect = document.getElementById('reading-style');
        const saveBtn = document.getElementById('save-settings');
        const testBtn = document.getElementById('test-api');

        // åŠ è½½å·²ä¿å­˜çš„è®¾ç½®
        if (AIConfig.enabled) toggle.classList.add('active');
        urlInput.value = AIConfig.apiBaseUrl;
        keyInput.value = AIConfig.apiKey;
        modelInput.value = AIConfig.model;
        langSelect.value = AIConfig.language;
        styleSelect.value = AIConfig.style;

        // åˆ‡æ¢AIå¯ç”¨
        toggle.addEventListener('click', () => {
            AIConfig.enabled = !AIConfig.enabled;
            toggle.classList.toggle('active');
        });

        // ä¿å­˜è®¾ç½®
        saveBtn.addEventListener('click', () => {
            AIConfig.apiBaseUrl = urlInput.value.trim();
            AIConfig.apiKey = keyInput.value.trim();
            AIConfig.model = modelInput.value.trim();
            AIConfig.language = langSelect.value;
            AIConfig.style = styleSelect.value;
            AIConfig.save();
            showSettingsMessage('âœ“ è®¾ç½®å·²ä¿å­˜ï¼Œå¼€å§‹è§£ç‰Œ...', 'success');
            // 3ç§’åè‡ªåŠ¨éšè—é…ç½®é¢æ¿å¹¶è¿›å…¥è§£ç‰Œæµç¨‹
            setTimeout(() => {
                hideSettingsPanel();
                currentReadingIndex = 0;
                if (selectedCardsData.length > 0) {
                    showReadingPanel(selectedCardsData[0].info);
                }
            }, 1500);
        });

        // æµ‹è¯•APIè¿æ¥
        testBtn.addEventListener('click', async () => {
            if (!AIConfig.apiKey) {
                showSettingsMessage('âœ— è¯·å…ˆè¾“å…¥ API å¯†é’¥', 'error');
                return;
            }
            showSettingsMessage('ğŸ”„ æµ‹è¯•ä¸­...', 'info');
            const success = await testAIConnection();
            if (success) {
                showSettingsMessage('âœ“ è¿æ¥æˆåŠŸ', 'success');
            } else {
                showSettingsMessage('âœ— è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®', 'error');
            }
        });

        // å¼€å§‹è§£ç‰ŒæŒ‰é’®
        const startReadingBtn = document.getElementById('start-reading');
        if (startReadingBtn) {
            startReadingBtn.addEventListener('click', () => {
                hideSettingsPanel();
                currentReadingIndex = 0;
                if (selectedCardsData.length > 0) {
                    showReadingPanel(selectedCardsData[0].info);
                }
            });
        }
    }

    function showSettingsMessage(msg, type = 'info') {
        const msgEl = document.getElementById('settings-message');
        msgEl.innerText = msg;
        msgEl.style.color = type === 'success' ? '#4ade80' : type === 'error' ? '#ff6b6b' : '#60a5fa';
    }

    function showSettingsPanel() {
        const panel = document.getElementById('settings-panel');
        panel.classList.add('show');
    }

    function hideSettingsPanel() {
        const panel = document.getElementById('settings-panel');
        panel.classList.remove('show');
    }

    async function testAIConnection() {
        try {
            const response = await fetch(`${AIConfig.apiBaseUrl}/chat/completions`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${AIConfig.apiKey}`
                },
                body: JSON.stringify({
                    model: AIConfig.model,
                    messages: [{ role: 'user', content: 'ping' }],
                    max_tokens: 10
                })
            });
            return response.ok;
        } catch (e) {
            console.error('API è¿æ¥å¤±è´¥:', e);
            return false;
        }
    }

    // ===== AI è§£ç‰ŒåŠŸèƒ½ =====
    let currentReadingIndex = 0;
    let currentReadingMode = 'normal'; // 'ai' æˆ– 'normal'

    async function callAIForReading(cardInfo) {
        const styles = {
            mystical: 'ç”¨ç¥ç§˜å­¦çš„è§’åº¦',
            psychological: 'ç”¨å¿ƒç†å­¦çš„è§’åº¦',
            practical: 'ç”¨å®ç”¨ä¸»ä¹‰çš„è§’åº¦',
            poetic: 'ç”¨è¯—æ„ä¼˜ç¾çš„æ–¹å¼'
        };

        const languages = {
            zh: 'ç”¨ä¸­æ–‡å›ç­”',
            en: 'Answer in English',
            bilingual: 'ç”¨ä¸­è‹±åŒè¯­å›ç­”'
        };

        const prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å¡”ç½—ç‰Œè§£è¯»å¸ˆã€‚è¯·${styles[AIConfig.style]}ã€${languages[AIConfig.language]}è§£è¯»ä»¥ä¸‹å¡”ç½—ç‰Œç‰Œä¹‰ï¼š

ç‰Œåï¼š${cardInfo.name}

è¯·æä¾›ï¼š
1. ç‰Œçš„åŸºæœ¬å«ä¹‰
2. åœ¨"è¿‡å»-ç°åœ¨-æœªæ¥"å åœä¸­çš„è§£è¯»
3. ç»™å‡ºè€…çš„å»ºè®®æˆ–å¯ç¤º

ä¿æŒå›ç­”ç®€æ´ï¼ˆ200-300å­—ï¼‰ï¼Œç¥ç§˜è€Œå¯Œæœ‰å¯å‘æ€§ã€‚`;

        try {
            const response = await fetch(`${AIConfig.apiBaseUrl}/chat/completions`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${AIConfig.apiKey}`
                },
                body: JSON.stringify({
                    model: AIConfig.model,
                    messages: [
                        {
                            role: 'system',
                            content: 'ä½ æ˜¯ä¸€ä½ç¥ç§˜è€Œå¯Œæœ‰æ™ºæ…§çš„å¡”ç½—ç‰Œè§£è¯»å¸ˆï¼Œèƒ½å¤Ÿæ·±åˆ»ç†è§£æ¯å¼ ç‰Œçš„è±¡å¾æ„ä¹‰ï¼Œå¹¶ç»™å‡ºå¯Œæœ‰å¯å‘æ€§çš„è§£è¯»ã€‚'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 500
                })
            });

            if (!response.ok) {
                throw new Error(`API é”™è¯¯: ${response.status}`);
            }

            const data = await response.json();
            return data.choices?.[0]?.message?.content || 'æ— æ³•è·å–è§£è¯»';
        } catch (error) {
            console.error('AI è°ƒç”¨å¤±è´¥:', error);
            return `âœ— çµèƒ½æ„Ÿåº”ä¸­æ–­ï¼ˆ${error.message}ï¼‰\n\n${getDefaultReading(cardInfo)}`;
        }
    }

    // é»˜è®¤è§£è¯»ï¼ˆå½“ AI ä¸å¯ç”¨æ—¶ï¼‰
    function showReadingPanel(cardInfo) {
        const panel = document.getElementById('reading-panel');
        const cardNameEl = document.getElementById('reading-card-name');
        const textEl = document.getElementById('reading-text');
        const loadingEl = document.getElementById('reading-loading');
        const errorEl = document.getElementById('reading-error');

        cardNameEl.innerText = cardInfo.name;
        textEl.innerHTML = '';
        loadingEl.style.display = 'block';
        errorEl.style.display = 'none';
        panel.classList.add('show');

        if (currentReadingMode === 'ai' && AIConfig.enabled && AIConfig.apiKey) {
            callAIForReading(cardInfo).then(reading => {
                loadingEl.style.display = 'none';
                textEl.innerHTML = reading.replace(/\n/g, '<br>');
            });
        } else {
            loadingEl.innerText = 'âœ¨ çµèƒ½è§£è¯»';
            setTimeout(() => {
                loadingEl.style.display = 'none';
                textEl.innerHTML = getDefaultReading(cardInfo).replace(/\n/g, '<br>');
            }, 800);
        }
    }

    function hideReadingPanel() {
        document.getElementById('reading-panel').classList.remove('show');
    }

    function showChoicePanel() {
        document.getElementById('reading-choice-panel').classList.add('show');
    }

    function hideChoicePanel() {
        document.getElementById('reading-choice-panel').classList.remove('show');
    }

    // é€‰æ‹©è§£ç‰Œæ–¹å¼
    document.getElementById('choice-ai').addEventListener('click', () => {
        currentReadingMode = 'ai';
        hideChoicePanel();
        // æ˜¾ç¤ºé…ç½®é¢æ¿è®©ç”¨æˆ·ç¡®è®¤ AI é…ç½®
        showSettingsPanel();
    });

    document.getElementById('choice-normal').addEventListener('click', () => {
        currentReadingMode = 'normal';
        hideChoicePanel();
        currentReadingIndex = 0;
        if (selectedCardsData.length > 0) {
            showReadingPanel(selectedCardsData[0].info);
        }
    });

    // è§£ç‰Œé¢æ¿æŒ‰é’®äº‹ä»¶
    document.getElementById('next-reading').addEventListener('click', () => {
        currentReadingIndex++;
        if (currentReadingIndex < selectedCardsData.length) {
            showReadingPanel(selectedCardsData[currentReadingIndex].info);
        } else {
            hideReadingPanel();
            finishReading();
        }
    });

    document.getElementById('finish-reading').addEventListener('click', () => {
        hideReadingPanel();
        finishReading();
    });

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playMagicSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); const filter = audioCtx.createBiquadFilter();
        osc.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
        if (type === 'shuffle') { osc.type='sawtooth'; osc.frequency.setValueAtTime(60,now); osc.frequency.linearRampToValueAtTime(40,now+0.1); filter.type='lowpass'; filter.frequency.setValueAtTime(200,now); gain.gain.setValueAtTime(0.1,now); gain.gain.exponentialRampToValueAtTime(0.001,now+0.1); osc.start(now); osc.stop(now+0.1); } 
        else if (type === 'fly') { osc.type='sine'; osc.frequency.setValueAtTime(200,now); osc.frequency.exponentialRampToValueAtTime(600,now+0.8); gain.gain.setValueAtTime(0,now); gain.gain.linearRampToValueAtTime(0.1,now+0.1); gain.gain.linearRampToValueAtTime(0,now+0.8); osc.start(now); osc.stop(now+0.8); }
        else if (type === 'reveal') { osc.type='triangle'; osc.frequency.setValueAtTime(880,now); gain.gain.setValueAtTime(0,now); gain.gain.linearRampToValueAtTime(0.15,now+0.05); gain.gain.exponentialRampToValueAtTime(0.001,now+2); osc.start(now); osc.stop(now+2); }
    }

    const TAROT_DATA = [
        { name: "0. The Fool (æ„šè€…)", url: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg" },
        { name: "I. The Magician (é­”æœ¯å¸ˆ)", url: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg" },
        { name: "II. The High Priestess (å¥³ç¥­å¸)", url: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg" },
        { name: "III. The Empress (çš‡å)", url: "https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg" },
        { name: "IV. The Emperor (çš‡å¸)", url: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg" },
        { name: "V. The Hierophant (æ•™çš‡)", url: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg" },
        { name: "VI. The Lovers (æ‹äºº)", url: "https://upload.wikimedia.org/wikipedia/commons/3/3a/TheLovers.jpg" },
        { name: "VII. The Chariot (æˆ˜è½¦)", url: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg" },
        { name: "VIII. Strength (åŠ›é‡)", url: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg" },
        { name: "IX. The Hermit (éšå£«)", url: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg" },
        { name: "X. Wheel of Fortune (å‘½è¿ä¹‹è½®)", url: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg" },
        { name: "XI. Justice (æ­£ä¹‰)", url: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg" },
        { name: "XII. The Hanged Man (å€’åŠäºº)", url: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg" },
        { name: "XIII. Death (æ­»ç¥)", url: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg" },
        { name: "XIV. Temperance (èŠ‚åˆ¶)", url: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg" },
        { name: "XV. The Devil (æ¶é­”)", url: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg" },
        { name: "XVI. The Tower (é«˜å¡”)", url: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg" },
        { name: "XVII. The Star (æ˜Ÿæ˜Ÿ)", url: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg" },
        { name: "XVIII. The Moon (æœˆäº®)", url: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg" },
        { name: "XIX. The Sun (å¤ªé˜³)", url: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg" },
        { name: "XX. Judgement (å®¡åˆ¤)", url: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg" },
        { name: "XXI. The World (ä¸–ç•Œ)", url: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg" }
    ];

    // ä¿å­˜åŸå§‹æ•°æ®ï¼Œç”¨äºé‡ç½®
    const TAROT_DATA_BACKUP = JSON.parse(JSON.stringify(TAROT_DATA));

    const textureLoader = new THREE.TextureLoader();
    textureLoader.setCrossOrigin('anonymous');
    const loadedTextures = {};
    let loadedCount = 0;
    const loadingText = document.getElementById('loading-text');
    const loadingBar = document.getElementById('loading-bar');
    const startBtn = document.getElementById('start-btn');

    // --- å¤‡ç”¨æ–¹æ¡ˆï¼šå¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¸¦æ–‡å­—çš„å¡é¢ ---
    function createFallbackCardFace(text) {
        const canvas = document.createElement('canvas');
        canvas.width = 256; canvas.height = 512;
        const ctx = canvas.getContext('2d');
        // èƒŒæ™¯
        ctx.fillStyle = "#222"; ctx.fillRect(0,0,256,512);
        // è¾¹æ¡†
        ctx.strokeStyle = "#d4af37"; ctx.lineWidth = 10; ctx.strokeRect(10,10,236,492);
        // æ–‡å­—
        ctx.fillStyle = "#d4af37"; ctx.font = "bold 24px 'Cinzel'"; 
        ctx.textAlign = "center";
        
        // è‡ªåŠ¨æ¢è¡Œç®€å•å¤„ç†
        const words = text.split(' ');
        let line = '';
        let y = 200;
        for(let n = 0; n < words.length; n++) {
            const testLine = line + words[n] + ' ';
            if(ctx.measureText(testLine).width > 200 && n > 0) {
                ctx.fillText(line, 128, y);
                line = words[n] + ' ';
                y += 40;
            } else {
                line = testLine;
            }
        }
        ctx.fillText(line, 128, y);
        
        const tex = new THREE.CanvasTexture(canvas);
        return tex;
    }

    function checkProgress() {
        loadedCount++;
        const pct = Math.floor((loadedCount / TAROT_DATA_BACKUP.length) * 100);
        loadingText.innerText = `èµ„æºåŠ è½½ä¸­... ${pct}%`;
        loadingBar.style.width = pct + '%';
        
        if (loadedCount >= TAROT_DATA_BACKUP.length) {
            loadingText.innerText = "âœ¨ å‘½è¿ä¹‹é—¨å·²å¼€å¯ âœ¨";
            startBtn.style.display = 'block';
        }
    }

    function preloadImages() {
        // è®¾ç½®ä¸€ä¸ª5ç§’è¶…æ—¶ï¼Œå¦‚æœ5ç§’è¿˜æ²¡ä¸‹å®Œï¼Œå¼ºåˆ¶å®Œæˆ
        setTimeout(() => {
            if(loadedCount < TAROT_DATA_BACKUP.length) {
                console.log("åŠ è½½è¶…æ—¶ï¼Œå¼ºåˆ¶å¯åŠ¨...");
                loadingText.innerText = "ç½‘ç»œå»¶è¿Ÿï¼Œå¯ç”¨å¤‡ç”¨å¡é¢...";
                startBtn.style.display = 'block';
                // å°†æœªåŠ è½½çš„å¼ºåˆ¶æ ‡è®°ä¸ºå®Œæˆï¼ˆåç»­ä½¿ç”¨fallbackï¼‰
            }
        }, 5000);

        TAROT_DATA_BACKUP.forEach(data => {
            const loader = new THREE.ImageLoader();
            loader.setCrossOrigin('anonymous');
            loader.load(
                data.url,
                (image) => {
                    const tex = new THREE.Texture(image);
                    tex.needsUpdate = true;
                    tex.center.set(0.5, 0.5);
                    loadedTextures[data.name] = tex;
                    checkProgress();
                },
                undefined, // onProgress
                (err) => {
                    // --- å…³é”®ä¿®æ”¹ï¼šåŠ è½½å¤±è´¥æ—¶ï¼Œç”Ÿæˆå¤‡ç”¨çº¹ç†ï¼Œä¸å¡æ­» ---
                    console.warn(`æ— æ³•åŠ è½½å›¾ç‰‡: ${data.name}, ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ`);
                    loadedTextures[data.name] = createFallbackCardFace(data.name);
                    checkProgress();
                }
            );
        });
    }
    preloadImages(); 

    const scene = new THREE.Scene(); scene.fog = new THREE.FogExp2(0x1a0b2e, 0.03);
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    
    // æ ¹æ®è®¾å¤‡æ–¹å‘è°ƒæ•´ç›¸æœºä½ç½®
    function updateCameraPosition() {
        const isMobile = window.innerWidth < 768;
        if (isMobile) {
            // æ‰‹æœºç«–å±ï¼šè°ƒæ•´ç›¸æœºè·ç¦»å’Œé«˜åº¦
            camera.position.set(0, 3, 10);
        } else {
            // æ¡Œé¢ï¼šåŸå§‹ä½ç½®
            camera.position.set(0, 5, 12);
        }
        camera.lookAt(0, 0, 0);
    }
    updateCameraPosition();
    
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight); renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);
    scene.add(new THREE.AmbientLight(0x404040, 1.5));
    const spotLight = new THREE.SpotLight(0xffd700, 1.2); spotLight.position.set(0, 15, 5); spotLight.castShadow = true; scene.add(spotLight);

    function createBackTexture() {
        const width = 512; const height = 1024; const canvas = document.createElement('canvas'); canvas.width = width; canvas.height = height; const ctx = canvas.getContext('2d'); const cx = width / 2; const cy = height / 2;
        const bgGrad = ctx.createRadialGradient(cx, cy, 100, cx, cy, height); bgGrad.addColorStop(0, "#2a1b3d"); bgGrad.addColorStop(1, "#000000"); ctx.fillStyle = bgGrad; ctx.fillRect(0, 0, width, height);
        for (let i = 0; i < 400; i++) { ctx.fillStyle = Math.random() > 0.5 ? "rgba(255,255,255,0.1)" : "rgba(212,175,55,0.15)"; ctx.beginPath(); ctx.arc(Math.random()*width, Math.random()*height, Math.random()*1.5, 0, Math.PI*2); ctx.fill(); }
        const goldGrad = ctx.createLinearGradient(0, 0, width, height); goldGrad.addColorStop(0, "#bf953f"); goldGrad.addColorStop(0.5, "#fcf6ba"); goldGrad.addColorStop(1, "#aa771c"); ctx.strokeStyle = goldGrad; ctx.fillStyle = goldGrad; ctx.shadowColor = "rgba(0,0,0,0.8)"; ctx.shadowBlur = 10;
        ctx.lineWidth = 8; ctx.strokeRect(20, 20, width-40, height-40); ctx.lineWidth = 2; ctx.strokeRect(35, 35, width-70, height-70);
        ctx.translate(cx, cy); ctx.lineWidth = 4; ctx.beginPath(); ctx.arc(0, 0, 140, 0, Math.PI*2); ctx.stroke();
        function drawTriangle(r, rot) { ctx.beginPath(); for(let i=0; i<3; i++) { let a = rot + i * Math.PI * 2 / 3; let x = Math.cos(a)*r; let y = Math.sin(a)*r; i==0? ctx.moveTo(x,y) : ctx.lineTo(x,y); } ctx.closePath(); ctx.stroke(); }
        ctx.lineWidth = 3; drawTriangle(100, -Math.PI/2); drawTriangle(100, Math.PI/2);
        ctx.font = "bold 80px 'Cinzel', serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.fillText("FATE", 0, 220); ctx.fillText("THE", 0, -200);
        return new THREE.CanvasTexture(canvas);
    }
    const backMaterial = new THREE.MeshStandardMaterial({ map: createBackTexture() });
    const sideMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });

    const cards = []; const deckGroup = new THREE.Group(); scene.add(deckGroup);
    for (let i = 0; i < 22; i++) {
        const tempFrontMat = new THREE.MeshStandardMaterial({ color: 0x222222 });
        const materials = [sideMaterial, sideMaterial, sideMaterial, sideMaterial, tempFrontMat, backMaterial];
        const card = new THREE.Mesh(new THREE.BoxGeometry(1.5, 2.6, 0.02), materials);
        card.rotation.x = Math.PI / 2; card.position.set(0, 0, -i * 0.02);
        card.userData = { id: i, isSelected: false }; cards.push(card); deckGroup.add(card);
    }

    let appState = 'WAITING_FOR_CLICK'; let drawnCount = 0; const selectedCardsData = [];
    const SLOTS = [{x:-4, label:"è¿‡å»"}, {x:0, label:"ç°åœ¨"}, {x:4, label:"æœªæ¥"}];
    const uiStatus = document.getElementById('status'); const progressBar = document.getElementById('progress-bar'); const cameraDiv = document.getElementById('camera-container'); const uiLayer = document.getElementById('ui-layer');

    startBtn.addEventListener('click', () => {
        if (audioCtx.state === 'suspended') audioCtx.resume(); playMagicSound('reveal');
        document.getElementById('start-overlay').style.display = 'none';
        cameraDiv.style.opacity = 0.8; uiLayer.style.opacity = 1;
        appState = 'IDLE'; uiStatus.innerHTML = "è¯·å¯¹ç€é•œå¤´ <b>æ¡ç´§æ‹³å¤´</b> ä»¥å¼€å§‹æ´—ç‰Œ";
        cameraUtils.start();
        loadSupplementaryReadings(); // åŠ è½½è¡¥å……è§£è¯»åº“
        initSettingsPanel();
    });

    let shuffleTimer = null; let shuffleSoundInterval = null;
    function startShuffling() {
        if (appState !== 'IDLE') return; appState = 'SHUFFLING'; uiStatus.innerHTML = "ğŸ”® èƒ½é‡æ³¨å…¥ä¸­..."; progressBar.style.display = 'block';
        let progress = 0; shuffleSoundInterval = setInterval(() => { playMagicSound('shuffle'); }, 150);
        shuffleTimer = setInterval(() => { progress += 2; progressBar.style.width = progress + '%'; cards.forEach(c => { c.position.y = (Math.random()-0.5)*0.5; c.rotation.z = (Math.random()-0.5)*0.2; }); if (progress >= 100) { finishShuffling(); } }, 50);
    }
    function finishShuffling() { clearInterval(shuffleTimer); clearInterval(shuffleSoundInterval); cards.forEach(c => { new TWEEN.Tween(c.position).to({y:0, x:0}, 300).start(); new TWEEN.Tween(c.rotation).to({z:0}, 300).start(); }); appState = 'READY_TO_SPREAD'; uiStatus.innerHTML = "âœ¨ æ´—ç‰Œå®Œæˆï¼è¯· <b>å¼ å¼€æ‰‹æŒ</b> é“ºå¼€ç‰Œé˜µ"; progressBar.style.display = 'none'; }
    function spreadCards() { if (appState !== 'READY_TO_SPREAD') return; appState = 'FANNING'; uiStatus.innerHTML = "ğŸ´ è¯·ä¼¸å‡º <b>é£ŸæŒ‡</b> æŠ½å–å¡ç‰Œ"; playMagicSound('fly'); const totalArc = Math.PI * 0.8; cards.forEach((card, i) => { const angle = (i/22)*totalArc - (totalArc/2); new TWEEN.Tween(card.position).to({x: Math.sin(angle)*5, y: -1, z: Math.cos(angle)*5 - 6}, 1000).easing(TWEEN.Easing.Back.Out).start(); new TWEEN.Tween(card.rotation).to({x: 0, y: Math.PI - angle*0.5, z: 0}, 1000).start(); }); setTimeout(() => { appState = 'WAITING_FOR_PICK'; }, 1000); }

    function pickCard() {
        if (appState !== 'WAITING_FOR_PICK' || drawnCount >= 3) return; appState = 'PICKING'; playMagicSound('fly');
        const available = cards.filter(c => !c.userData.isSelected); if(available.length === 0) return;
        const card = available[Math.floor(Math.random()*available.length)]; card.userData.isSelected = true;
        const poolSize = TAROT_DATA.length;
        const info = TAROT_DATA.splice(Math.floor(Math.random()*poolSize), 1)[0];
        selectedCardsData.push({mesh: card, info: info, slot: drawnCount});

        // è·å–é¢„åŠ è½½çš„çº¹ç†ï¼Œå¦‚æœæ²¡æœ‰ï¼ˆæ¯”å¦‚ä¸‹è½½å¤±è´¥ï¼‰ï¼Œå°±ç°åœºç”Ÿæˆä¸€ä¸ªå¤‡ç”¨çš„
        let preloadedTex = loadedTextures[info.name];
        if (!preloadedTex) preloadedTex = createFallbackCardFace(info.name);

        card.material[4] = new THREE.MeshStandardMaterial({ map: preloadedTex, roughness: 0.4 });
        card.material.needsUpdate = true;

        const slot = SLOTS[drawnCount];
        new TWEEN.Tween(card.position).to({x: slot.x, y: 1.5, z: 2}, 1000).easing(TWEEN.Easing.Cubic.Out).start();
        new TWEEN.Tween(card.rotation).to({x:0, y:Math.PI, z:0}, 1000).start();
        new TWEEN.Tween(card.scale).to({x:1.1, y:1.1, z:1.1}, 1000).onComplete(()=>{ drawnCount++; if(drawnCount < 3) { appState = 'WAITING_FOR_PICK'; uiStatus.innerHTML = `å·²é€‰å®š[${SLOTS[drawnCount-1].label}]ï¼Œè¯·ç»§ç»­...`; } else { appState = 'REVEALING'; uiStatus.innerHTML = "ğŸ”® å‡†å¤‡æ­æ™“å‘½è¿..."; setTimeout(revealCards, 1500); } }).start();
    }

    function revealCards() {
        selectedCardsData.forEach((item, i) => {
            setTimeout(() => {
                playMagicSound('reveal');
                new TWEEN.Tween(item.mesh.rotation).to({y:0}, 1500).easing(TWEEN.Easing.Elastic.Out).start();
                const box = document.getElementById(`label-box-${i}`);
                const contentSpan = box.querySelector('.card-content');
                const displayName = item.info.name.split('. ')[1]; 
                contentSpan.innerText = displayName;
                box.style.opacity = 1;
            }, i * 1500);
        });
        setTimeout(() => { 
            uiStatus.innerHTML = "âœ¨ ä»ªå¼å®Œæˆ";
            appState = 'FINISHED';
            // è¿›å…¥è§£ç‰Œé€‰æ‹©ç¯èŠ‚
            setTimeout(() => {
                showChoicePanel();
            }, 800);
        }, 5000);
    }

    function finishReading() {
        hideReadingPanel();
        hideChoicePanel();
        appState = 'IDLE';
        drawnCount = 0;
        selectedCardsData.length = 0;
        TAROT_DATA.length = 0;
        TAROT_DATA.push(...TAROT_DATA_BACKUP);
        document.querySelectorAll('.card-label-box').forEach(box => box.style.opacity = 0);
        uiStatus.innerHTML = "è¯·å¯¹ç€é•œå¤´ <b>æ¡ç´§æ‹³å¤´</b> ä»¥å¼€å§‹æ–°çš„ä»ªå¼";
        
        // é‡æ–°æ’åˆ—å¡ç‰Œ
        cards.forEach((card, i) => {
            card.userData.isSelected = false;
            new TWEEN.Tween(card.position).to({x: 0, y: 0, z: -i * 0.02}, 1000).start();
            new TWEEN.Tween(card.rotation).to({x: Math.PI/2, y: 0, z: 0}, 1000).start();
            card.material[4] = new THREE.MeshStandardMaterial({color: 0x222222});
            card.material.needsUpdate = true;
        });
        
        console.log('ä»ªå¼å®Œæˆï¼Œå¯å¼€å§‹æ–°è½®');
    }

    const videoEl = document.getElementById('input_video');
    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
    hands.onResults((res) => { if (!res.multiHandLandmarks || res.multiHandLandmarks.length === 0) return; const lm = res.multiHandLandmarks[0]; const isIndex = lm[8].y < lm[6].y; const isPinky = lm[20].y < lm[18].y; if (appState === 'IDLE' && !isIndex && !isPinky) startShuffling(); else if (appState === 'READY_TO_SPREAD' && isIndex && isPinky) spreadCards(); else if (appState === 'WAITING_FOR_PICK' && isIndex && !isPinky) pickCard(); });
    const cameraUtils = new Camera(videoEl, { onFrame: async () => { await hands.send({image: videoEl}); }, width: 320, height: 240 });

    function animate() { requestAnimationFrame(animate); TWEEN.update(); renderer.render(scene, camera); }
    animate();
    window.onresize = () => { 
        camera.aspect = innerWidth / innerHeight; 
        camera.updateProjectionMatrix(); 
        renderer.setSize(innerWidth, innerHeight);
        updateCameraPosition();
    };
</script>
</body>
</html>
